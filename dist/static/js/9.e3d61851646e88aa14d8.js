webpackJsonp([9],{Afcc:function(e,t){},rcfM:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("//Fk"),i=s.n(a),o=s("2Wsv"),n=s("lq4Q"),l={name:"columnAdd",components:{},data:function(){return{uploadUrl:"",fileKey:"",downloadUrl:"",yanType:[],tips:"",enter:{},imageKey:"",typeIds:"",model:"",onDate:"",bombName:"",options:[{value:"kao",label:"烤烟型"},{value:"you",label:"油烟型"}]}},created:function(){this.tips=this.$router.currentRoute.query.tips},mounted:function(){this.enter=JSON.parse(localStorage.getItem("enter")),this.init()},methods:{init:function(){var e=this;Object(n.e)({pageIndex:1,pageSize:1e3,isVisible:"y"},this.enter.sessionId).then(function(t){if(e.yanType=t.bussData,!e.tips){var s={id:e.$router.currentRoute.query.id};Object(n.c)(s,e.enter.sessionId).then(function(t){if(console.log(t),e.bombName=t.bussData.bombName,e.fileKey=t.bussData.imageKey,e.imageKey=t.bussData.imageUrl,e.model=t.bussData.model,e.onDate=t.bussData.onDate,e.typeIds=t.bussData.typeIds,e.yanType.length>0&&e.typeIds){var s=e.typeIds.split(",");e.yanType.forEach(function(e){s.forEach(function(t){e.id==t&&(e.isChoose=1)})})}console.log(e.imageKey)})}})},choose:function(e,t){this.yanType[t].isChoose?delete this.yanType[t].isChoose:this.yanType[t].isChoose=1,this.$forceUpdate()},rewriteUpload:function(e){var t=this;console.log(e),o.a.put(this.uploadUrl,e.file,{headers:{"Content-Type":e.file.type}}).then(function(){t.imageKey=t.downloadUrl})},handleAvatarSuccess:function(e,t){console.log(e,t)},beforeAvatarUpload:function(e){var t=this;return console.log(e),e.size/1024/1024<2?new i.a(function(s,a){console.log(e.name.split(".")[1],e.type),Object(n.i)(e.name.split(".")[1],e.type).then(function(e){console.log(e),t.uploadUrl=e.bussData.uploadUrl,t.fileKey=e.bussData.fileKey,t.downloadUrl=e.bussData.downloadUrl,s(e)})}):(this.$message.error("上传头像图片大小不能超过 2MB!"),!1)},submit:function(){if(this.model)if(this.bombName)if(this.onDate){var e=this.yanType.filter(function(e){return e.isChoose});console.log(e),e&&(e=e.map(function(e){return e.id}),this.typeIds=e.join(",")),console.log(this.typeIds),this.typeIds?this.fileKey?this.tips?this.addName():this.upDateName():this.$message({message:"请上传图片",type:"warning"}):this.$message({message:"请选择支持烟型",type:"warning"})}else this.$message({message:"请选择上市日期",type:"warning"});else this.$message({message:"请选择烟弹类型",type:"warning"});else this.$message({message:"请输入设备型号",type:"warning"})},addName:function(){var e=this,t={bombName:this.bombName,imageKey:this.fileKey,model:this.model,onDate:this.onDate,typeIds:this.typeIds};Object(n.a)(t,this.enter.sessionId).then(function(t){t&&(e.$router.push({path:"/column/column"}),console.log(t))})},upDateName:function(){var e=this,t={id:this.$router.currentRoute.query.id,bombName:this.bombName,imageKey:this.fileKey,model:this.model,onDate:this.onDate,typeIds:this.typeIds};Object(n.f)(t,this.enter.sessionId).then(function(t){console.log(t.bussData.uploadUrl),e.$message({message:"设备更改成功",type:"success"}),e.$router.push({path:"/column/column"})})}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columAdd"},[s("div",{staticClass:"w-100 h-100 p-15"},[s("el-breadcrumb",{staticClass:"p-15 b-b-f0",attrs:{separator:"/","separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",[e._v("设备管理》"+e._s("add"==e.tips?"新增":"编辑"))])],1),e._v(" "),s("div",{staticClass:"w-100 p-15"},[s("ul",{staticClass:"wrap"},[s("li",{staticClass:"flex"},[s("em",{staticClass:"nowrap",staticStyle:{"line-height":"40px"}},[e._v("设备型号：")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入"},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1),e._v(" "),s("li",{staticClass:"flex"},[s("em",{staticClass:"nowrap",staticStyle:{"line-height":"40px"}},[e._v("烟弹类型：")]),e._v(" "),s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.bombName,callback:function(t){e.bombName=t},expression:"bombName"}},e._l(e.options,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("li",{staticClass:"flex"},[s("em",{staticClass:"nowrap",staticStyle:{"line-height":"40px"}},[e._v("上市日期：")]),e._v(" "),s("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.onDate,callback:function(t){e.onDate=t},expression:"onDate"}})],1),e._v(" "),s("li",{staticClass:"flex"},[s("em",{staticClass:"nowrap",staticStyle:{"line-height":"40px"}},[e._v("支持烟型：")]),e._v(" "),s("div",e._l(e.yanType,function(t,a){return s("span",{staticClass:"typeBtn",style:{background:t.isChoose?"#90ee90":"#fff"},on:{click:function(s){return e.choose(t,a)}}},[e._v(e._s(t.name))])}),0)]),e._v(" "),s("li",{staticClass:"flex"},[s("em",{staticClass:"nowrap",staticStyle:{"line-height":"40px"}},[e._v("设备照片：")]),e._v(" "),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","http-request":e.rewriteUpload,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.imageKey?s("img",{staticClass:"avatar",attrs:{src:e.imageKey}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)]),e._v(" "),s("div",{staticClass:"footer"},[s("el-button",{attrs:{plain:""},on:{click:e.submit}},[e._v("确定")])],1)])],1)])},staticRenderFns:[]};var c=s("VU/8")(l,r,!1,function(e){s("Afcc")},null,null);t.default=c.exports}});
//# sourceMappingURL=9.e3d61851646e88aa14d8.js.map